---
title: 双音拨号信号产生与分析
tags: [Code,Matlab]
mathjax: true
categories: Study
---

# 双音拨号信号产生与分析

git：[Degital_Singal_Process/Dual-tone_dialing_system at main · kylinhx/Degital_Singal_Process (github.com)](https://github.com/kylinhx/Degital_Singal_Process/tree/main/Dual-tone_dialing_system)

## 一、设计依据及要求

### 1、设计依据

根据掌握的数字信号处理的相关知识，利用matlab软件编写程序，产生电话中的DTMF信号。用DFT检测DTMF信号所含有的两个音频频率。

### 2、设计要求

#### 2.1、设计任务描述

按照相关 规范，双音话机每秒最多按10个键，即每键时隙最短为100MS，其中音频实 际持续时间至少为 45MS ， 不大于55MS，时隙的其他时间内保持静默

#### 2.2设计任务要求

1.设计一个程序产生双音电话拨号信号的程序。输入电话号码的字符串，输出8000 样值/秒的时域离散序列

2.采用DFT等方法对样值序列进行分析，输出分析所得到的电话号码，并与拨号信号程序的输入电话号码进行比较

#### 2.3设计内容要求

1.双音多频信号的产生，DTMF信号用两个不同频率正弦信号相加，一个高频一个低频。

2.双音多频信号的检测，在接收端，要对收到的多音双频信号进行检测，检测两个正弦波的频率是多少，以判断对应的十进制数字或符号。

3.用DFT对模拟信号进行谱分析，需要确定三个参数：

（1）采样频率Fs； （2）DFT变换点数N； （3）对信号的观察时间的长度Tp

4.对信号频谱分析也有三个要求：

（1）频率分辨率；（2）谱分析的频谱范围；（3）检测频率的准确性

## 二、双音频信号产生与检测的原理及内容

### 1、DTMF原理介绍

​	双多音频（Dual Tone MultiFrequency,DTMF）信号是音频电话中的拨号信号，由美国AT&T贝尔公司实验室研制，并用于电话网络中。这种信号制式具有很高的拨号速度，且容易自动监测识别，很快就代替了原有的用脉冲计数方式的拨号制式。

​	DTMF由高频群和低频群组成，高低频群各包含4个频率。一个高频信号和一个低频信号叠加组成一个组合信号，代表一个数字。DTMF信令有16个编码。

​	在电话中，数字0\~9中的每一个都用两个不同的单音频传输，所用的8个频率分成高频带和低频带两组，低频带有四个频率：679Hz，770Hz，852Hz和941Hz；高频带也有四个频率：1209Hz，1336Hz，1477Hz和1633Hz。每一个数字均由高、低频带中各一个频率构成。

​	例如1用697Hz和1209Hz两个频率，信号用$\sin(2\pi f_1 t)+\sin(2\pi f_2 t)$表示，其中，$f_1=679Hz$，$f_2=1209Hz$。

​	这样8个频率形成16种不同的双频信号。具体号码以及符号对应的频率如图1所示。

![](1.png)

​	DTMF信号在电话中有两种作用，一个是用拨号信号去控制交换机接通被叫的用户电话机，另一个是控制电话机的各种动作，如播放留言、语音信箱等

### 2、DTMF信号产生与检测

#### 2.1、双音频信号的产生

​	假设时间是连续的，DTMF信号用$x(t)=\sin(2\pi f_1 t)+\sin(2\pi f_2 t)$表示，式中$f_1$和$f_2$是按照图一选择的两个频率，$f_1$代表低频带中的一个频率，$f_2$代表高频带中的一个频率。显然采用数字方法产生DTMF信号。

​	规定用$8000Hz$对DTMF信号进行采样，采样后得到的时域离散信号为：
​	$x(t)=\sin(2\pi f_1 n/8000)+\sin(2\pi f_2 n/8000)$

​	形成上面序列的方法一共有两种：计算法和查表法。利用计算法求正弦波的序列值容易，但实际中要占用一些计算时间，影响运行速度。查表法是预先将正弦波的各序列值计算出来，寄存在存储器中，运行时只要按顺序和一定的速度取出便可。这种方法占用一定的存储空间，但是速度更快。

#### 2.2、基于Goertzel算法的双音多频信号检测

​	DTMF双音频信号是一高一低两种频率的正弦波叠加，那么最简单的思路当然是DFT变换，然后看不同频率的幅值进而判断传了什么信号按了什么键。

​	然而进一步考虑，对DTMF的检测无需得知相位信息也无需计算所有的频点。因为DTMF的频率是已知的，所以直接针对已知的8种频率的频点进行计算即可。

​	Goertzel算法由GeraldGoertzel在1958年提出，用于数字信号处理，是属于离散傅里叶变换的范畴，目的是从给定的采样中求出某一特定频率信号的能量，用于有效性的评价。

这个算法有几个关键的参数：

1.采样率R，指的是需要分析的数据每秒钟有多少个采样

2.目标频率f，指的是需要检测并评价的这个频率的值

3.检测区段采样值数量N，也就是每N个采样这个算法会对频率f给出评价

4.检测区段包含目标频率的完整周期个数K

上述参数应有这样的关系：


$K=\dfrac{Nf}{R}$

这个K值应该是一个整数，而且要大小合适。如果太大，不利于检测的时效，如果太小，则检测可能不准确。

接下来计算每个采样在一个目标频率一个周期中所占的弧度ω，由于N个采样周期表达了K个周期（2$\pi$），那么$\omega$计算公式为：


$\omega=\dfrac{2\pi K}{N}$

因为K值可能经过了四舍五入，所以上述两个公式必须先后计算，不能合在一起化简把K约掉

接着可以得到后期计算会频繁遇到的系数C：


$C=2\cos(\omega)=2\cos(\dfrac{2\pi K}{N})$

以上参数，可以事先计划好，不必在每个采样分析中再次计算。之后，就开始针对N个采样点进行分析计算。

首先初始化：


$Q_1=0$

$Q_2=0$


然后按照顺序针对N个采样每一个值S，做如下计算：


$Q_0=CQ_1-Q_2+S$

$Q_2=Q_1$

$Q_1=Q_0$


上述计算完成之后，我们就可以得到在这N个采样中所体现的频率f的能量值P:


$P=Q_1^{2}+Q_2^{2}-CQ_1Q_2$

想要将Goertzel算法应用于DTMF识别，还需要做一些工作。我们需要根据给定的一段时间的采样，能够最大限度地排除噪音的干扰，将有效的DTMF信号识别出来。

我们知道DTMF有8个频率：697, 770, 852, 941, 1209, 1336, 1477,
1633，通过前4个频率和后4个频率的两两组合，确定16个符号。那么我们在对给定一段时间的采样进行处理的时候，就需要先将其分为每段为N个采样的多个采样区段，然后对每一区段针对8个频率分别运用goertzel算法进行计算得到每个频率的能量P。

为了完成这些能量的计算，我们需要在开始针对8个不同的频率分别计算系数C，而参数N的选择非常关键，因为8个频率的K值都不同，我们要尽可能使得8个频率的K值四舍五入之后都误差尽可能小，经过检验，在采样率为8000的时候，N=205应该是一个最佳值，其误差见表1



  **f**    **K实际值**    **K近似值**   **计算偏差(相对值%)**

------- ------------- ------------- -----------------------
  697        17.861                18                     0.8
  770        19.731                20                     1.4
  852        21.833                22                     0.8
  941        24.113                24                     0.5
  1209       30.981                31                     0.1
  1336       34.235                34                     0.7
  1477       37.848                38                     0.4
  1633       41.846                42                     0.4



确定$F_s=8000Hz$，$N=205$，$T_p\ge40ms$

## 三、程序设计与运行结果

DTMF信号的产生与识别仿真实验在MATLAB环境下进行，编写仿真程序、运行程序，送入8位电话号码，程序自动产生每一位号码数字相应的DTMF信号，并送出双频声音，再用DFT进行谱分析，显示每一位号码数字的DTMF信号的DFT幅度谱，按照幅度谱的最大值确定对应的频率，再按照频率确定每一位对应的号码数字，最后输出8位电话号码。

### 1、设计程序

程序先获得输入的8位电话号码，然后产生时域离散的DTMF信号，并且连续发出8位号码对应的双音频声音，之后对时域离散的DTMF信号进行检测，画出幅度谱，根据峰值查找并确定8位电话号码。

![程序流程图](2.png)

程序完整代码展示

```matlab
%双频拨号信号的生成和检测程序
%clear all;clc;
tm=[1,2,3,65;4,5,6,66;7,8,9,67;42,0,35,68] 
N=205;K=[18,20,22,24,31,34,38,42];
f1=[697,770,852,941];
f2=[1209,1336,1477,1633];
TN=input('键入8位电话号码：');
TNt=0;
for m=1:8:
  d=fix(TN/10^(8-m));
  TN=TN-d*10^(8-m);
  for p=1:4:
    for q=1:4:
      if tm(p,q)==abs(d);break,end
        end
      if tm(p,q)==abs(d);break,end
        end
  n=0:1023;
  x = sin(2*pi*n*f1(p)/8000) + sin(2*pi*n*f2(q)/8000);
  sound(x,8000);
  pause(0.1)
%接收检测端的程序
  X=goertzel(x(1:N),K+1);
  val=abs(X);
  subplot(4,2,m);
  stem(K,val,'.');grid;
  xlabel('k');ylabel('|X(k)|');
  axis([10 50 0 120])
  limit=80;
  for s=5:8:
      if val(s)>limit,break,end
  end
  for r=1:4:
      if val(r)>limit,break,end
  end
  TNt=TNt+tm(r,s-4)*10^(8-m)
  end
disp('接收端检测到的信号是：');
disp(TNt)
```

### 2、程序运行结果

在MATLAB中运行程序后，输入8位电话号码，可以听到8位电话号码对应的DTMF信号的声音，并且输出相应的幅频图。图2为程序成功运行的截图，图3为示例65432132相对应的幅频图。图4为数字1、2、3、4、5、6、7、8、9对应的幅频图。


![](3.jpg)

![](4-16784363501942.png)

![](5-16784363401721.png)
比对图3、4可以得出输入的电话号码为65432132。说明检测成功。

## 参考文献

\[1\]程佩青，《数字信号处理教程》，清华大学出版社；

\[2\]John G.Proakis，Dimitris G.Manolakis，《数字信号处理--原理、算法与应用》，电子工业出版社；

\[3\]部分算法原理内容来源于CSDN、知乎、百度百科等平台。
